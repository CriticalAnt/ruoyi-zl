<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org"
      xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<meta charset="utf-8">
<head th:include="include :: header"></head>
<link th:href="@{/ajax/libs/jquery-ztree/3.5/css/metro/zTreeStyle.css}" rel="stylesheet"/>
<!--<link href="https://cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css"-->
<!--rel="stylesheet"/>-->

<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
    <form class="form-horizontal m" id="form-role-add">
        <div class="btn-group-sm hidden-xs" id="toolbar" role="group">
            <a class="btn btn-success" id="addRowbtn" shiro:hasPermission="system:datapoint:add">
                <i class="fa fa-plus"></i> 新增
            </a>
            <a class="btn btn-primary btn-edit" onclick="javascript:update()"
               shiro:hasPermission="system:datapoint:edit">
                <!--onclick="$.operate.edit()"-->
                <i class="fa fa-edit"></i> 保存
            </a>
            <a class="btn btn-danger btn-del disabled" id="removeBtn"
               shiro:hasPermission="system:datapoint:remove">
                <i class="fa fa-remove"></i> 删除
            </a>
            <!--<a class="btn btn-warning" onclick="$.table.exportExcel()" shiro:hasPermission="system:data:export">
                <i class="fa fa-download"></i> 导出
            </a>-->
        </div>
        <table id="bootstrap-table"></table>
        <!--<div class="col-sm-12 select-table table-striped">-->
        <!--<table id="reportTable" data-mobile-responsive="true"></table>-->
        <!--</div>-->
    </form>
</div>
<div th:include="include::footer"></div>
<script th:src="@{/ajax/libs/jquery-ztree/3.5/js/jquery.ztree.all-3.5.js}"></script>
<!--<script th:src="@{/ajax/libs/bootstrap-table/extensions/editable/bootstrap-table-editable.min.js}"></script>-->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>-->
<script th:inline="javascript">
    var addFlag = [[${@permission.hasPermi('system:datapoint:add')}]];
    var editFlag = [[${@permission.hasPermi('system:datapoint:edit')}]];
    var removeFlag = [[${@permission.hasPermi('system:datapoint:remove')}]];
    var datas = [[${@dict.getType('sys_normal_disable')}]];
    var prefix = ctx + "system/datapoint";


    /*$(function () {
        var options = {
            url: prefix + "/list",
            createUrl: prefix + "/add",
            addPointUrl: addPoint + "/add",
            updateUrl: prefix + "/edit/{id}",
            removeUrl: prefix + "/remove",
            exportUrl: prefix + "/export",
            sortName: "id",
            modalName: "数据模板",
            search: false,
            showExport: false,
            columns: [{
                checkbox: true
            },
                {
                    field: "pointName",
                    title: "数据点名称",
                }, {
                    field: "dataType",
                    title: "数据类型",
                }, {
                    field: "registerAdr",
                    title: "寄存器",
                },
                {
                    field: "valueType",
                    title: "数值类型",
                }, {
                    field: "decimalLen",
                    title: "小数位数",
                }, {
                    field: "readType",
                    title: "读写",
                }, {
                    field: "registerLen",
                    title: "寄存器长度"
                }, {
                    field: "unit",
                    title: "单位"
                }, {
                    field: "formula",
                    title: "公式"
                }, {
                    field: "storageType",
                    title: "数据存储",
                }]
        };
        $.table.init(options);
        var $table = $('#bootstrap-table');
        var $button = $('#addRowbtn');
        $button.click(function () {
            $table.bootstrapTable('insertRow', {
                index: 0,
                row: {
                    pointName: '',
                    dataType: 1,
                    registerAdr: '',
                    valueType: 1,
                    decimalLen: 0,
                    readType: 0,
                    registerLen: '',
                    unit: '',
                    formula: '',
                    storageType: 1
                }
            });
        });
    });*/

    $(function () {
        var $table = $('#bootstrap-table');
        var $button = $('#addRowbtn');
        var $remove = $('#removeBtn');
        var options = {
            toolbar: "#toolbar",
            idField: "Id",
            pagination: true,
            showRefresh: true,
            search: true,
            clickToSelect: false,
            queryParams: function (param) {
                return {};
            },
            //url: "/Editable/GetUsers",
            //data: [{UserName : "1",Age : 20,Birthday:"2015-1-1",DeptName:"bufen",Hodd:"wu"},{UserName : "2",Age : 21,Birthday:"20135-1-1",DeptName:"b1ufen",Hodd:"w4u"}],
            columns: [{
                checkbox: true
            }, {
                field: "id",
                title: "唯一id",
                visible: false
            }, {
                field: "pointName",
                title: "数据点名称",
                editable: {
                    type: 'text',
                    title: '数据点名称',
                    mode: "inline",
                    validate: function (v) {
                        if (!v) return '数据点名称不能为空';

                    }
                }
            }, {
                field: "dataType",
                title: "数据类型",
                editable: {
                    type: 'select',
                    title: '数据类型',
                    mode: "inline",
                    source: [{value: "1", text: "数值型"}]
                }
            }, {
                field: "registerAdr",
                title: "寄存器",
                editable: {
                    type: 'text',
                    title: '寄存器',
                    mode: "inline",
                    validate: function (v) {
                        if (!v) return '寄存器地址不能为空';
                    }
                }
            },
                {
                    field: "valueType",
                    title: "数值类型",
                    editable: {
                        type: 'select',
                        title: '数值类型',
                        mode: "inline",
                        source: [
                            {value: "1", text: "2字节无符号整数"},
                            {value: "2", text: "2字节有符号整数"},
                            {value: "3", text: "4字节无符号整数(AB CD)"},
                            {value: "4", text: "4字节无符号整数(CD AB)"},
                            {value: "5", text: "4字节有符号整数(AB CD)"},
                            {value: "6", text: "4字节有符号整数(CD AB)"},
                            {value: "7", text: "4字节浮点型(AB CD)"},
                            {value: "8", text: "4字节浮点型(CD AB)"}
                        ]
                    }
                }, {
                    field: "decimalLen",
                    title: "小数位数",
                    editable: {
                        type: 'select',
                        title: '小数位数',
                        mode: "inline",
                        source: [
                            {value: 0, text: "0(小数位数)"},
                            {value: 1, text: "1(小数位数)"},
                            {value: 2, text: "2(小数位数)"},
                            {value: 3, text: "3(小数位数)"},
                            {value: 4, text: "4(小数位数)"}
                        ]
                    }
                }, {
                    field: "readType",
                    title: "读写",
                    editable: {
                        type: 'select',
                        title: '读写',
                        mode: "inline",
                        source: [
                            {value: 0, text: "只读"},
                            {value: 1, text: "读写"},
                            {value: 2, text: "只写"}
                        ]
                    }
                }, {
                    field: "registerLen",
                    title: "寄存器长度"
                }, {
                    field: "unit",
                    title: "单位"
                }, {
                    field: "formula",
                    title: "公式"
                }, {
                    field: "storageType",
                    title: "数据存储",
                    editable: {
                        type: 'select',
                        title: '数据存储',
                        mode: "inline",
                        source: [
                            {value: 1, text: "不存储"},
                            {value: 2, text: "存储"},
                            {value: 3, text: "变化时存储"}
                        ]
                    }
                }]
        };
        $button.click(function () {
            $table.bootstrapTable('insertRow', {
                index: 0,
                row: {
                    id: guid(),
                    pointName: '',
                    dataType: 1,
                    registerAdr: '',
                    valueType: 1,
                    decimalLen: 0,
                    readType: 0,
                    registerLen: '',
                    unit: '',
                    formula: '',
                    storageType: 1
                }
            });
        });
        $remove.click(function () {

            // $table.bootstrapTable('removeAll');
            //批量删除
            var ids = $.map($table.bootstrapTable('getSelections'), function (row) {
                return row.id
            });
            // var rows = $table
            // alert(ids);
            $table.bootstrapTable('remove', {
                field: 'id',
                values: ids
            });

        });
        $table.bootstrapTable(options);

        function guid() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }
    });

    /*$(function () {
        var $table = $('#reportTable');
        var $button = $('#addRowbtn');
        var $getTableData = $('#getTableData');

        $button.click(function () {
            $table.bootstrapTable('insertRow', {
                index: 0,
                row: {
                    id: '',
                    name: 'name',
                    price: 'price'
                }
            });
        });

        $table.bootstrapTable({
            url: 'data2.json',
            toolbar: '#toolbar',
            clickEdit: true,
            showToggle: true,
//            pagination: true,       //显示分页条
//            showColumns: true,
//            showPaginationSwitch: true,     //显示切换分页按钮
            showRefresh: true,      //显示刷新按钮
            //clickToSelect: true,  //点击row选中radio或CheckBox
            columns: [{
                checkbox: true
            }, {
                field: 'id',
                title: 'Item ID',
                edit: {
                    type: 'select',//下拉框
                    //数据来源地址
                    //url:'user/getUser.htm',
                    data: [{id: 1, text: 'lzx'}, {id: 2, text: 'lsl'}],
                    valueField: 'id',
                    textField: 'text',
                    onSelect: function (val, rec) {
                        console.log(val, rec);
                    }
                }
            }, {
                field: 'name',
                title: 'Item Name',
                edit: {
                    type: 'select',//下拉框
                    //数据来源地址
                    //url:'user/getUser.htm',
                    data: [{id: 1, text: 'lzx'}, {id: 2, text: 'lsl'}],
                    valueField: 'id',
                    textField: 'text',
                    onSelect: function (val, rec) {
                        console.log(val, rec);
                    }
                }
            }, {
                field: 'price',
                title: 'Item Price',
                edit: {
                    type: 'select',//下拉框
                    //数据来源地址
                    //url:'user/getUser.htm',
                    data: [{id: 1, text: 'lzx'}, {id: 2, text: 'lsl'}],
                    valueField: 'id',
                    textField: 'text',
                    onSelect: function (val, rec) {
                        console.log(val, rec);
                    }
                }
            },
                {
                    field: "toRun", title: "Run Flag", align: "center", edit: {
                    type: 'select',//下拉框
//                    url: './index.php?r=dictionary/dictionaryInfo&type=' + "run",
                    data:[{id:1,text:'hello'},{id:2,text:'hi'}],
                    valueField: 'id',
                    textField: 'text',
                    editable: false,
                    onSelect: function (val, rec) {
                        //console.log(val,rec);
                    }
                }, sortable: true
                }
            ],
            /!**
             * @param {点击列的 field 名称} field
             * @param {点击列的 value 值} value
             * @param {点击列的整行数据} row
             * @param {td 元素} $element
             *!/
            onClickCell: function (field, value, row, $element) {
                $element.attr('contenteditable', true);
                $element.blur(function () {
                    var index = $element.parent().data('index');
                    var tdValue = $element.html();

                    saveData(index, field, tdValue);
                })
            }
        });

        $getTableData.click(function () {
            alert(JSON.stringify($table.bootstrapTable('getData')));
        });

        function saveData(index, field, value) {
            $table.bootstrapTable('updateCell', {
                index: index,       //行索引
                field: field,       //列名
                value: value        //cell值
            })
        }

    });*/

    /*$(function () {
        var options = {
            url: prefix + "/list",
            createUrl: prefix + "/add",
            updateUrl: prefix + "/edit/{id}",
            removeUrl: prefix + "/remove",
            exportUrl: prefix + "/export",
//            sortName: "",
            sortName: "id",
            modalName: "数据模板",
            search: false,
            showExport: false,
            columns: [
                {
                    checkbox: true
                },
                {
                    field: 'id',
                    title: '模板ID',
                    sortable: true
                },
                {
                    field: 'modelName',
                    title: '模板名称',
                    sortable: true
                },
                {
                    field: 'wtf',
                    title: '关联数据点',
                },
                {
                    title: '操作',
                    align: 'center',
                    formatter: function (value, row, index) {
                        var actions = [];
                        actions.push('<a class="btn btn-success btn-xs ' + addFlag + '" href="#" onclick="$.operate.addFullTitle(\'' + '数据点' + '\')"><i class="fa fa-edit"></i>添加数据点</a> ');
                        actions.push('<a class="btn btn-primary btn-xs ' + editFlag + '" href="#" onclick="data(\'' + row.id + '\')"><i class="fa fa-check-square-o"></i>编辑</a> ');
                        actions.push('<a class="btn btn-danger btn-xs ' + removeFlag + '" href="#" onclick="$.operate.remove(\'' + row.id + '\')"><i class="fa fa-remove"></i>删除</a>');
                        return actions.join('');
                    }
                }]
        };
        $.table.init(options);
    });*/

    /*$(function () {
        //编辑表格
        $('#reportTable').bootstrapTable({
            //数据来源的网址
            url: '/index.xhtml',
            method: 'post',
            editable: true,//开启编辑模式
            clickToSelect: true,
            showPaginationSwitch: true, //显示分页切换按钮
            search: true,  //显示检索框
            showRefresh: true,  //显示刷新按钮
            showToggle: true, //显示切换按钮来切换列表/卡片视图
            pagination: true,
            pageList: [10, 25],
            pageSize: 10,
            pageNumber: 1,
            columns: [
                {checkbox: true},
                {field: "id", edit: false, title: "编号", align: "center"},
                /!*{
                    field: "user_company", edit: {
                    type: 'select',//下拉框
                    //数据来源地址
                    //url:'user/getUser.htm',
                    data: [{id: 1, text: 'lzx'}, {id: 2, text: 'lsl'}],
                    valueField: 'id',
                    textField: 'text',
                    onSelect: function (val, rec) {
                        console.log(val, rec);
                    }
                }, title: "下拉框", align: "center", width: "200px"
                },*!/
                /!*{
                    field: "time", edit: {
                    type: 'date',//日期
                    required: true,
                    click: function () {
                    }
                }, title: "时间", align: "center"
                },*!/
                {field: "name", title: "名字", align: "center", edit: true},
                {field: "age", title: "年龄", align: "center"},
                {
                    field: "gender",
                    title: "性别",
                    align: "center",
                    width: "200px",
                    formatter: function (value, row, rowIndex) {
                        if (value == 1) {
                            return '男';
                        } else if (value == 2) {
                            return '女';
                        }
                    },
                    edit: {
                        type: 'select',//下拉框
                        //数据来源地址
                        data: [{id: 1, text: '男'}, {id: 2, text: '女'}],
                        valueField: 'id',
                        textField: 'text',
                        onSelect: function (val, rec) {
                            console.log(val, rec);
                        }
                    }
                }
                // {field:"userstatus_end_time",title:"操作",align:"center",formatter:function(value,row,rowIndex){
                //  var strHtml ='<a href="javascript:void(0);" onclick="removeRow('+row+')">删除</a>';
                //  return strHtml;
                // },edit:false}
            ]
        });
        $('#addRowbtn').click(function () {
            var data = {};
            $('#reportTable').bootstrapTable('append', data);
        });

        $('sava').onClickCell(function () {

        });


    });*/

    /*function removeRow(row) {
        console.log(row);
    }*/

    /*function update() {
        var row = $('#reportTable').bootstrapTable('getSelections')
        console.log(row)
        location.href = "delete.action?uid=" + row.uid
        var row = $('#dg').datagrid('reload');
    }*/

    /*function sava() {
        var row = $('#reportTable').bootstrapTable('getSelections');
        if (row.length == 1) {
            console.log(a[0].id);
        } else {
            console.log(row.name);
            alert("请选中一行")
        }
    }*/

    /*角色管理-分配数据权限*/
    /*function data(id) {
        var url = prefix + '/edit/' + id;
        $.modal.open("修改数据模板", url);
    }*/

</script>
</body>
</html>
